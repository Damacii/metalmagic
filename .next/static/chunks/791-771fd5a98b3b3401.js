(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{791:function(e,r,t){Promise.resolve().then(t.bind(t,3827))},3827:function(e,r,t){"use strict";t.d(r,{default:function(){return d}});var a=t(7437),s=t(6648),l=t(2265),n=t(7555),i=t(1180),o=t(1263);function d(){let[e,r]=(0,l.useState)(null),[t,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(n.o),[g,m]=(0,l.useState)({}),[x,p]=(0,l.useState)(null),[b,y]=(0,l.useState)(!0),[h,f]=(0,l.useState)(!1),[v,N]=(0,l.useState)(null),[w,j]=(0,l.useState)({}),[S,k]=(0,l.useState)(n.N),[O,C]=(0,l.useState)(""),[I,_]=(0,l.useState)(""),[E,A]=(0,l.useState)(o.rk),U=(0,l.useRef)(null),z=(null==e?void 0:e.toLowerCase())===n.N.toLowerCase(),P=!!e;(0,l.useEffect)(()=>{if(!i.O){y(!1);return}let e=!0,t=i.O;(async()=>{var a,s,l;let{data:n}=await t.auth.getSession();e&&(r(null!==(l=null===(s=n.session)||void 0===s?void 0:null===(a=s.user)||void 0===a?void 0:a.email)&&void 0!==l?l:null),y(!1))})();let{data:a}=t.auth.onAuthStateChange((e,t)=>{var a,s;r(null!==(s=null==t?void 0:null===(a=t.user)||void 0===a?void 0:a.email)&&void 0!==s?s:null)});return()=>{e=!1,a.subscription.unsubscribe()}},[]),(0,l.useEffect)(()=>{if(!i.O||!z)return;let e=!0,r=i.O;return(async()=>{let{data:t,error:a}=await r.from("gallery_items").select("src, category");if(a||!t||!e)return;let s={};t.forEach(e=>{e.category&&(s[e.src]=e.category)}),m(s)})(),()=>{e=!1}},[z]);let L=(0,l.useMemo)(()=>E.map(e=>{var r,t,a;return{...e,category:null!==(a=null!==(t=null!==(r=w[e.src])&&void 0!==r?r:g[e.src])&&void 0!==t?t:e.tags[0])&&void 0!==a?a:"Other"}}),[E,g,w]),F=async e=>{if(e.preventDefault(),d(null),!i.O){d("Supabase is not configured.");return}let{error:r}=await i.O.auth.signInWithOtp({email:S,options:{shouldCreateUser:!1}});d(r?r.message:"Check your email for the sign-in link.")},G=async()=>{if(d(null),!i.O){d("Supabase is not configured.");return}if(!S||!O){d("Enter an email and password to log in.");return}let{error:e}=await i.O.auth.signInWithPassword({email:S,password:O});d(e?e.message:"Signed in.")},J=async()=>{i.O&&(await i.O.auth.signOut(),r(null))},M=(e,r)=>{j(t=>({...t,[e]:r}))},X=async e=>{if(!i.O||!z)return;let r=w[e];if(!r)return;p(e),d(null);let{error:t}=await i.O.from("gallery_items").upsert({src:e,category:r},{onConflict:"src"});t?d(t.message):(m(t=>({...t,[e]:r})),j(r=>{let t={...r};return delete t[e],t})),p(null)},Y=async e=>{var r;let t=Array.from(null!==(r=e.target.files)&&void 0!==r?r:[]);if(t.length&&i.O){N(null),f(!0);try{let e=[];for(let r of t){let t=r.name.replace(/\s+/g,"-"),a="".concat(Date.now(),"-").concat(t),{error:s}=await i.O.storage.from("Fotos").upload(a,r,{cacheControl:"3600",upsert:!1});if(s)throw s;let{data:l}=i.O.storage.from("Fotos").getPublicUrl(a),n=l.publicUrl;e.push({src:n,tags:["Gallery"]}),m(e=>({...e,[n]:"Gallery"})),await i.O.from("gallery_items").upsert({src:n,category:"Gallery"},{onConflict:"src"})}A(r=>[...e,...r]),N("Upload complete.")}catch(e){N(e instanceof Error?e.message:"Upload failed.")}finally{f(!1),U.current&&(U.current.value="")}}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,a.jsxs)("div",{className:"container",children:[i.O?null:(0,a.jsx)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 text-sm text-gray-600 shadow-sm",children:"Set `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY` to enable admin access."}),b?(0,a.jsx)("div",{className:"mt-6 text-sm text-gray-500",children:"Loading your session..."}):null,b||z||P?null:(0,a.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-[1.1fr_0.9fr] lg:items-center",children:[(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-10 text-gray-900 shadow-sm",children:[(0,a.jsx)("div",{className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-100 px-4 py-2 text-[11px] uppercase tracking-[0.35em] text-gray-600",children:"Admin Studio"}),(0,a.jsx)("h2",{className:"mt-6 text-4xl font-semibold text-gray-900 md:text-5xl",children:"Tag the gallery with precision."}),(0,a.jsx)("p",{className:"mt-4 max-w-lg text-base text-gray-600",children:"Organize images by category so visitors can filter instantly. Only verified admin accounts can update tags."}),(0,a.jsxs)("div",{className:"mt-8 grid gap-4 md:grid-cols-3",children:[(0,a.jsx)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 text-sm text-gray-700",children:"Live tags"}),(0,a.jsx)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 text-sm text-gray-700",children:"Supabase sync"}),(0,a.jsx)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 text-sm text-gray-700",children:"Admin-only"})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-8 text-gray-900 shadow-sm",children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-[0.35em] text-gray-500",children:"Sign In"}),(0,a.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:"Use your admin email to receive a magic link or sign in with a password."}),(0,a.jsxs)("form",{onSubmit:F,className:"mt-6 grid gap-5",children:[(0,a.jsxs)("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:["Email",(0,a.jsx)("input",{type:"email",required:!0,value:S,onChange:e=>k(e.target.value),className:"mt-2 w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-900 placeholder-gray-400 focus:border-gray-300 focus:outline-none"})]}),(0,a.jsxs)("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:["Password (optional)",(0,a.jsx)("input",{type:"password",value:O,onChange:e=>C(e.target.value),className:"mt-2 w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-900 placeholder-gray-400 focus:border-gray-300 focus:outline-none"})]}),(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsx)("button",{type:"submit",className:"w-full rounded-2xl bg-black px-5 py-3 text-sm font-semibold text-white transition hover:bg-gray-900",children:"Send Magic Link"}),(0,a.jsx)("button",{type:"button",onClick:G,className:"w-full rounded-2xl border border-gray-200 bg-white px-5 py-3 text-xs font-semibold uppercase tracking-[0.25em] text-gray-900 transition hover:bg-gray-100",children:"Log In"})]})]}),t?(0,a.jsx)("div",{className:"mt-5 rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:t}):null]})]}),b||!P||z?null:(0,a.jsxs)("div",{className:"mt-8 rounded-2xl border border-amber-200 bg-amber-50 p-6 text-amber-900 shadow-sm",children:[(0,a.jsxs)("div",{className:"text-sm",children:["You are signed in as ",e,", but this account is not authorized to edit the gallery."]}),(0,a.jsx)("button",{type:"button",onClick:J,className:"mt-4 rounded-xl border border-amber-200 bg-amber-100 px-4 py-3 text-xs font-semibold uppercase tracking-[0.25em] text-amber-900 transition hover:bg-amber-200",children:"Sign Out"})]}),!b&&z?(0,a.jsxs)("div",{className:"mt-10 space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-[0.35em] text-gray-500",children:"Admin Session"}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-900",children:["Signed in as ",e]})]}),(0,a.jsx)("button",{type:"button",onClick:J,className:"rounded-full border border-gray-200 bg-gray-900 px-5 py-2 text-xs font-semibold uppercase tracking-[0.25em] text-white transition hover:bg-black",children:"Sign Out"})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsx)("span",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Add Category"}),(0,a.jsx)("input",{type:"text",value:I,onChange:e=>_(e.target.value),placeholder:"New category",className:"w-full max-w-xs rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 text-sm text-gray-900 placeholder-gray-400 focus:border-gray-300 focus:outline-none"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=I.trim();!e||c.includes(e)||(u(r=>[...r,e]),_(""))},className:"rounded-xl border border-gray-200 bg-gray-900 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] !text-white transition hover:bg-black",children:"Add"}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-200"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;null===(e=U.current)||void 0===e||e.click()},disabled:h,className:"rounded-xl border border-gray-200 bg-black px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] !text-white transition hover:bg-gray-900 disabled:cursor-not-allowed disabled:opacity-60",children:h?"Uploading...":"Add New Image"}),(0,a.jsx)("input",{ref:U,type:"file",accept:"image/*",multiple:!0,onChange:Y,className:"hidden"})]}),v?(0,a.jsx)("div",{className:"mt-4 text-sm text-gray-600",children:v}):null]}),(0,a.jsx)("div",{className:"grid gap-5 md:grid-cols-2 xl:grid-cols-3",children:L.map((e,r)=>(0,a.jsxs)("div",{className:"group flex flex-col gap-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm transition hover:border-gray-300",children:[(0,a.jsxs)("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 bg-gray-100",children:[(0,a.jsx)("div",{className:"absolute left-3 top-3 z-10 rounded-full bg-white/90 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em] text-gray-700",children:r+1}),(0,a.jsx)("div",{className:"absolute right-3 top-3 z-10 rounded-full border border-gray-200 bg-white/90 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-gray-700",children:e.category}),(0,a.jsx)("div",{className:"relative aspect-[4/3]",children:(0,a.jsx)(s.default,{src:e.src,alt:"Gallery preview",fill:!0,sizes:"(max-width: 1024px) 100vw, 33vw",unoptimized:!0,className:"object-cover transition duration-500 group-hover:scale-[1.02]"})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)("label",{className:"text-[10px] uppercase tracking-[0.35em] text-gray-500",children:"Category"}),(0,a.jsxs)("div",{className:"grid gap-2 md:grid-cols-[1fr_auto] md:items-center",children:[(0,a.jsx)("select",{value:e.category,onChange:r=>M(e.src,r.target.value),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-gray-300 focus:outline-none",children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("button",{type:"button",onClick:()=>X(e.src),disabled:!w[e.src]||x===e.src,className:"rounded-xl border border-gray-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-black transition hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50",children:x===e.src?"Saving...":"Save"})]})]})]},e.src))})]}):null]})})}},7555:function(e,r,t){"use strict";t.d(r,{N:function(){return a},o:function(){return s}});let a="admin@damacii.com",s=["Fences","Gates","Railings","Security","Repairs","Custom Fabrication","Other"]},1180:function(e,r,t){"use strict";t.d(r,{O:function(){return n}});var a=t(4593);let s="https://qavufnmvclihoacgnsql.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhdnVmbm12Y2xpaG9hY2duc3FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1NTE3NTQsImV4cCI6MjA4MzEyNzc1NH0.DSgogUXohj92shNZiy_m5_xZw4VquI-sHOSu8cK-isU",n=s&&l?(0,a.eI)(s,l):null},6648:function(e,r,t){"use strict";t.d(r,{default:function(){return s.a}});var a=t(5601),s=t.n(a)},5601:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{default:function(){return o},getImageProps:function(){return i}});let a=t(9920),s=t(497),l=t(8173),n=a._(t(1241));function i(e){let{props:r}=(0,s.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,t]of Object.entries(r))void 0===t&&delete r[e];return{props:r}}let o=l.Image}}]);